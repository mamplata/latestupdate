$(document).ready(function(){function n(){return $('meta[name="csrf-token"]').attr("content")}function e(){return $.ajax({url:"/api/csrf-cookie",type:"GET",xhrFields:{withCredentials:true}})}function i(){return $.ajax({url:"/api/check-user",type:"GET",xhrFields:{withCredentials:true},headers:{"X-CSRF-TOKEN":n()}})}function r(e){if(e){if(e==="admin"){window.location.href="/management-admin"}else if(e==="agriculturist"){window.location.href="/management-agriculturist"}}}$("#loginForm").on("submit",function(e){e.preventDefault();$.ajax({url:"/api/login",type:"POST",data:{username:$("#username").val(),password:$("#password").val()},headers:{"X-CSRF-TOKEN":n()},success:function(e){if(e.user){r(e.user.role)}else{$("#loginResult").html('<div class="alert alert-danger">Login failed!</div>')}},error:function(e){var n=e.responseJSON?e.responseJSON.message:"Login failed!";$("#loginResult").html('<div class="alert alert-danger">'+n+"</div>")}})});e().done(function(){i().done(function(e){if(e.message!=="Invalid Token"){var n=e.user.role;if(n){r(n)}else{console.log("No cookie session found.")}}})})});