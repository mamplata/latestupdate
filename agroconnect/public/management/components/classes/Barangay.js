import Dialog from"../helpers/Dialog.js";let barangays=[];class Barangay{constructor(a,e,n){this.barangayId=a;this.barangayName=e;this.coordinates=n}createBarangay(e){const a=barangays.find(a=>a.barangayName===e.barangayName);if(a){alert("Barangay already exists");return}fetch("/api/barangays",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(a=>a.json()).then(a=>{})["catch"](a=>{console.error("Error:",a)})}updateBarangay(e){const a=barangays.find(a=>a.barangayName===e.barangayName);if(a&&a.barangayId!==e.barangayId){alert("Barangay already exists");return}barangays=barangays.map(a=>a.barangayId===e.barangayId?{...a,...e}:barangays);fetch(`/api/barangays/${e.barangayId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(a=>a.json()).then(a=>{})["catch"](a=>{console.error("Error:",a)})}removeBarangay(e){fetch(`/api/barangays/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(a=>{if(a.status===204){barangays=barangays.filter(a=>a.barangayId!==a);}else if(a.status===404){console.error(`Barangay with ID ${e} not found.`)}else{console.error(`Failed to delete barangay with ID ${e}.`)}})["catch"](a=>{console.error("Error:",a)})}}function getBarangay(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});$.ajax({url:"/api/barangays",method:"GET",success:function(a){let e=a;barangays=e;},error:function(a,e,n){console.error("Error fetching barangays:",n)}})}getBarangay();async function fetchCoordinates(a){a=`${a}, Cabuyao, Laguna, Philippines`;const e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}`);const n=await e.json();if(n&&n.length>0){return[parseFloat(n[0].lat),parseFloat(n[0].lon)]}return null}async function getCoordinates(a){const e=await fetchCoordinates(a);if(e){const n=`${e[0]},${e[1]}`;return n}else{return"Location not found."}}function searchBarangay(e){const a=barangays.filter(a=>a.barangayName.toLowerCase().includes(e.toLowerCase()));return a}function initializeMethodsBarangay(){var o=null;var l=5;var s=1;var n=null;var e=false;async function i(a=null){await new Promise(a=>setTimeout(a,1e3));$("#barangayTableBody").empty();var e=(s-1)*l;var n=e+l;if(a){const o=searchBarangay(a);if(o.length>0){o.forEach(a=>{$("#barangayTableBody").append(`
                <tr data-index=${a.barangayId}>
                  <td style="display: none;">${a.barangayId}</td>
                  <td>${a.barangayName}</td>
                  <td>${a.coordinates}</td>
                </tr>
              `)})}else{$("#barangayTableBody").append(`
              <tr>
                <td colspan="4">barangay not found!</td>
              </tr>
            `)}}else{for(var t=e;t<n;t++){if(t>=barangays.length){break}var r=barangays[t];$("#barangayTableBody").append(`
            <tr data-index=${r.barangayId}>
              <td style="display: none;">${r.barangayId}</td>
              <td>${r.barangayName}</td>
              <td>${r.coordinates}</td>
            </tr>
          `)}}}i();$("#search").on("input",function(){let a=$("#search").val();i(a)});$("#prevBtn").click(function(){if(s>1){s--;i()}});$("#nextBtn").click(function(){var a=Math.ceil(barangays.length/l);if(s<a){s++;i()}});$("#submitBtn").click(function(a){a.preventDefault();var n=Number($("#barangayId").val());var t=$("#barangayName").val();if(o!==null&&e){getCoordinates(t).then(a=>{r=a;if(r==="Location not found."){alert("Unknown location in Cabuyao");return}let e=new Barangay(n,t,r);e.updateBarangay(e);getBarangay();i()});o=null;$("#submitBtn").text("Add barangay");$("#cancelBtn").hide();d();e=false}else{var r="";getCoordinates(t).then(a=>{r=a;if(r==="Location not found."){alert("Unknown location in Cabuyao");return}let e=new Barangay(n,t,r);e.createBarangay(e);getBarangay();i()})}$("#barangayForm")[0].reset();o=null;$("#barangayTableBody tr").removeClass("selected-row");$("#editBtn").prop("disabled",true);$("#deleteBtn").prop("disabled",true)});function d(){$("#editBtn").prop("disabled",true);$("#deleteBtn").prop("disabled",true);o=null;$("#barangayTableBody tr").removeClass("selected-row")}$("#editBtn").click(async function(){const a=await Dialog.confirmDialog("Confirm Edit","Are you sure you want to edit this barangay's details?");if(a.operation===1){$("#editModal").modal("hide");$("#cancelBtn").show();$("#barangayId").val(n.barangayId);$("#barangayName").val(n.barangayName);$("#submitBtn").text("Update Barangay");e=true}$("#barangayTableBody tr").removeClass("selected-row");$("#editBtn").prop("disabled",true);$("#deleteBtn").prop("disabled",true)});$("#cancelEdit").click(function(){d()});$("#cancelBtn").click(function(){o=null;$("#barangayForm")[0].reset();$("#submitBtn").text("Add Barangay");$("#cancelBtn").hide();$("#barangayTableBody tr").removeClass("selected-row");$("#editBtn").prop("disabled",true);$("#deleteBtn").prop("disabled",true)});$("#deleteBtn").click(async function(){const a=await Dialog.confirmDialog("Confirm Deletion","Are you sure you want to delete this barangay?");if(a.operation===1){$("#deleteModal").modal("hide");let a=new Barangay;a.removeBarangay(n.barangayId);getBarangay();i();d()}else{$("#editBtn").prop("disabled",true);$("#deleteBtn").prop("disabled",true)}});$("#cancelDelete").click(function(){d()});$("#barangayTableBody").on("click","tr",function(){var a=$(this);var e=a.data("index");n=barangays.find(a=>a.barangayId===e);o=e;if(o!==null){$("#barangayTableBody tr").removeClass("selected-row");$("#barangayTableBody tr").filter(function(){return parseInt($(this).find("td:eq(0)").text(),10)===o}).addClass("selected-row");$("#editBtn").prop("disabled",false);$("#deleteBtn").prop("disabled",false)}else{$("#barangayTableBody tr").removeClass("selected-row")}})}export{Barangay,getBarangay,searchBarangay,barangays,initializeMethodsBarangay};